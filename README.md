# Photo GIS Viewer

写真のEXIF情報から位置情報を抽出し、地図上に表示するWebアプリケーションです。

## 🚀 すぐに始める

**最も簡単な方法:**
1. このリポジトリをダウンロード（または `git clone`）
2. `index.html` をダブルクリックしてブラウザで開く
3. 「📁 フォルダを選択」ボタンをクリック
4. 写真が入ったフォルダを選択

**推奨ブラウザ:** Chrome または Edge
**大量の写真（200枚以上）の場合:** `index-lite.html` を使用

---

## 🚀 特徴

- **フォルダ一括処理**: フォルダ内の全ての画像を一度に処理
- **GPS位置情報表示**: EXIF情報から位置データを抽出して地図に表示
- **詳細情報表示**: 撮影日時、カメラ機種、撮影設定などを表示
- **写真プレビュー**: 地図上のマーカーから写真を直接確認
- **フィルター機能**: 日付範囲やカメラ機種で絞り込み
- **GISデータエクスポート**: 位置情報をGeoJSON・CSV形式で出力
- **レスポンシブデザイン**: デスクトップ・モバイル対応

## 🛠️ 技術スタック

- **HTML5 / CSS3 / JavaScript (ES6+)**
- **Leaflet.js**: 地図表示
- **OpenStreetMap**: 地図タイル
- **ExifReader.js**: EXIF情報読み取り
- **File System Access API**: フォルダアクセス

## 📋 対応ブラウザ

**推奨ブラウザ (フォルダ選択対応):**
- Google Chrome 86+ (フル機能)
- Microsoft Edge 86+ (フル機能)
- Safari 14+ (制限あり - WebKit Directory API)
- Firefox 90+ (制限あり - WebKit Directory API)

**その他のブラウザ:**
- 古いブラウザでは個別ファイル選択のみ対応
- 機能制限がある場合は自動的に代替手段を提供

## 🎯 対応ファイル形式

- JPEG (.jpg, .jpeg)
- PNG (.png)
- TIFF (.tiff, .tif)

## 🚀 使用方法

### 基本的な使い方

1. **ファイルを開く**
   - `index.html` をダブルクリック（標準版）
   - または `index-lite.html`（軽量版 - 大量の写真用）

2. **写真フォルダを選択**
   - 「📁 フォルダを選択」ボタンをクリック
   - GPS情報付き写真が入ったフォルダを選択
   - アプリが自動的に画像ファイルを検索・処理

3. **地図で確認**
   - 位置情報のある写真が地図上にマーカーで表示
   - マーカーをクリックすると写真のプレビューと詳細情報が表示
   - 写真をクリックすると拡大表示

4. **GISデータエクスポート（オプション）**
   - 写真処理完了後、「📊 GISエクスポート」ボタンが表示
   - ボタンをクリックすると別ウィンドウでエクスポート画面が開く
   - エクスポート形式を選択し「エクスポート開始」をクリック
   - GeoJSON、CSV、メタデータファイルが個別にダウンロード

**代替方法（トラブル時）:**
```bash
# ローカルサーバーを起動
python -m http.server 8000
# ブラウザで http://localhost:8000 にアクセス
```

**推奨環境:**
- **Chrome または Edge**: フル機能利用可能
- **Safari または Firefox**: 基本機能利用可能  
- **大量の写真（200枚以上）**: `index-lite.html` を使用

## 🔧 機能詳細

### EXIF情報の抽出

- **GPS座標**: 緯度・経度
- **撮影日時**: DateTimeOriginal, DateTime, DateTimeDigitized
- **カメラ情報**: メーカー、機種、レンズ
- **撮影設定**: 絞り、シャッタースピード、ISO、焦点距離

### 地図機能

- **マーカークラスタリング**: 多数の写真を効率的に表示
- **自動ズーム調整**: 全ての写真が見えるよう自動調整
- **ポップアップ表示**: 写真プレビューと基本情報
- **モーダル表示**: 写真の詳細情報と拡大表示

## 🛡️ プライバシーとセキュリティ

- **完全ローカル処理**: 写真はブラウザ内でのみ処理され、外部に送信されません
- **一時的なアクセス**: 選択されたフォルダへのアクセスは一時的です
- **メタデータのみ**: 位置情報とメタデータのみを使用
- **CDNフォールバック**: 外部ライブラリが読み込めない場合の代替手段を提供
- **機能縮退**: 一部機能が利用できない場合でも基本機能は維持

## 🐛 トラブルシューティング

### フォルダが選択できない

- Chrome または Edge の最新版を使用してください（推奨）
- Safari や Firefox でも基本的な機能は利用できます
- ブラウザの File System Access API が有効になっているか確認してください

### 写真が地図に表示されない

- 写真にGPS情報が含まれているか確認してください
- スマートフォンの位置情報設定が有効だったか確認してください
- 古いカメラやスキャンした写真には位置情報が含まれていません

### 処理が遅い・メモリエラー

- **大量の写真（200枚以上）**: 自動的に軽量版への切り替えを提案します
- **メモリ使用量**: アプリが自動的にメモリ使用量を監視し、警告を表示します
- **ブラウザのメモリ確保**: 他のタブを閉じてメモリを確保してください
- **軽量版の使用**: `index-lite.html` を使用してください

### ライブラリ読み込みエラー

- **自動フォールバック**: CDNからの読み込みに失敗した場合、代替CDNを自動的に試行します
- **オフライン対応**: 必要なライブラリがない場合、機能縮退モードで基本機能を提供します
- **ネットワーク確認**: インターネット接続を確認してページを再読み込みしてください

## 📝 開発・カスタマイズ

### ファイル構成

```
photo-gis-viewer/
├── index.html              # 標準版HTML
├── index-lite.html         # 軽量版HTML
├── export.html             # エクスポート専用ページ
├── css/
│   └── style.css          # スタイルシート
├── js/
│   ├── app.js             # 標準版アプリケーション
│   ├── app-lite.js        # 軽量版アプリケーション
│   ├── file-handler.js    # ファイル処理（ブラウザ互換性強化）
│   ├── exif-handler.js    # EXIF情報処理（メモリ効率化）
│   ├── map-handler.js     # 地図操作
│   └── gis-exporter.js    # GISデータエクスポート
├── libs/
│   └── fallback-loader.js # CDNフォールバック機能
└── README.md               # ドキュメント
```

### カスタマイズ方法

**地図の初期位置を変更:**
```javascript
// js/map-handler.js の initializeMap() 内
const defaultView = [35.6762, 139.6503]; // 東京
```

**対応ファイル形式を追加:**
```javascript
// js/file-handler.js の constructor() 内
this.supportedFormats = ['jpg', 'jpeg', 'png', 'tiff', 'tif', 'webp'];
```

**マーカーアイコンを変更:**
```javascript
// js/map-handler.js の createPhotoMarker() 内
const photoIcon = L.divIcon({
    className: 'photo-marker',
    html: '📷', // ここを変更
    iconSize: [30, 30]
});
```

## ⚠️ 制限事項

- **ブラウザサポート**: File System Access API対応ブラウザでフル機能利用可能
  - Chrome/Edge: フル機能
  - Safari/Firefox: 制限あり（WebKit Directory API使用）
- **処理能力**: 大量の写真処理時の推奨枚数
  - 標準版: ~200枚推奨（自動で軽量版への切り替えを提案）
  - 軽量版: 500枚以上対応
- **メモリ管理**: アプリが自動的にメモリ使用量を監視し最適化
- **ネットワーク依存**: CDN障害時は自動フォールバック機能で対応
- **位置情報**: 撮影方向（コンパス方向）の情報は取得できません

## 🤝 貢献・フィードバック

バグ報告や機能提案は以下の方法で受け付けています：

1. GitHubのIssueを作成
2. プルリクエストの送信
3. メールでの連絡

## 📜 ライセンス

MIT License - 詳細はLICENSEファイルを参照してください。

## 🙏 謝辞

- [Leaflet](https://leafletjs.com/) - オープンソース地図ライブラリ
- [OpenStreetMap](https://www.openstreetmap.org/) - オープンソース地図データ
- [ExifReader](https://github.com/mattiasw/ExifReader) - EXIF情報読み取りライブラリ
- [File System Access API](https://developer.mozilla.org/en-US/docs/Web/API/File_System_Access_API) - ファイルシステムアクセス

---

## 📊 使用例

### 旅行写真の整理
- 旅行先で撮影した写真の位置を地図で確認
- 撮影場所の記録と思い出の整理

### 建築関係
- 現場写真の地理的な整理

### 研究・調査活動
- フィールドワークでの写真管理
- 地理的データの可視化

### 個人的な記録
- 散歩や登山の記録
- ペットの写真の位置記録

---

**バージョン**: 1.0.0  
**最終更新**: 2025年6月